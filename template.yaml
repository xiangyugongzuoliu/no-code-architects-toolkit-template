apiVersion: zeabur.com/v1
kind: Template
metadata:
  name: nca-toolkit

spec:
  description: |
    No-Code Architects Toolkit - å¼ºå¤§çš„åª’ä½“å¤„ç† API å·¥å…·åŒ…

    âœ¨ æ ¸å¿ƒåŠŸèƒ½ï¼š
    â€¢ ğŸ¬ è‡ªåŠ¨è§†é¢‘å­—å¹•ç”Ÿæˆï¼ˆæ”¯æŒä¸­æ–‡ï¼‰
    â€¢ ğŸ¤ AI éŸ³è§†é¢‘è½¬å½•ï¼ˆWhisperï¼‰
    â€¢ ğŸï¸ FFmpeg éŸ³è§†é¢‘å¤„ç†
    â€¢ â˜ï¸ Cloudflare R2 / S3 / GCP Storage äº‘å­˜å‚¨
    â€¢ ğŸ“¦ äºŒè¿›åˆ¶æ–‡ä»¶ç›´æ¥ä¸Šä¼ 
    â€¢ ğŸŒ å®Œæ•´çš„ä¸­æ–‡å­—ä½“æ”¯æŒï¼ˆç®€ä½“/ç¹ä½“ï¼‰
    â€¢ ğŸš€ 50+ API ç«¯ç‚¹

    ğŸ“– éƒ¨ç½²åè®¿é—®æ ¹è·¯å¾„ / æŸ¥çœ‹å®Œæ•´ä»‹ç»å’Œä½¿ç”¨æŒ‡å—

  icon: https://raw.githubusercontent.com/xiangyugongzuoliu/no-code-architects-toolkit/main/assets/icon.svg
  coverImage: https://raw.githubusercontent.com/xiangyugongzuoliu/no-code-architects-toolkit/main/assets/cover.svg
  tags:
    - video
    - subtitle
    - ffmpeg
    - media
    - ai
    - whisper
    - transcription
  readme: |
    # NCA Toolkit - å¼ºå¤§çš„åª’ä½“å¤„ç† API å·¥å…·åŒ…

    ä¸€é”®éƒ¨ç½²åˆ° Zeaburï¼Œå¼€å§‹ä½¿ç”¨ 50+ ä¸ªåª’ä½“å¤„ç† API ç«¯ç‚¹ã€‚

    ## æ ¸å¿ƒåŠŸèƒ½

    - ğŸ¬ è‡ªåŠ¨è§†é¢‘å­—å¹•ç”Ÿæˆï¼ˆæ”¯æŒä¸­æ–‡ï¼‰
    - ğŸ¤ AI éŸ³è§†é¢‘è½¬å½•ï¼ˆWhisperï¼‰
    - ğŸï¸ FFmpeg éŸ³è§†é¢‘å¤„ç†
    - â˜ï¸ äº‘å­˜å‚¨é›†æˆï¼ˆR2/S3/GCPï¼‰
    - ğŸ“¦ äºŒè¿›åˆ¶æ–‡ä»¶ä¸Šä¼ 
    - ğŸŒ ä¸­æ–‡å­—ä½“æ”¯æŒ

    ## å¿«é€Ÿå¼€å§‹

    1. ç‚¹å‡»ä¸Šæ–¹"Deploy"æŒ‰é’®
    2. é…ç½®å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼ˆAPI_KEY å’Œäº‘å­˜å‚¨é…ç½®ï¼‰
    3. ç­‰å¾…éƒ¨ç½²å®Œæˆ
    4. è®¿é—®æ ¹è·¯å¾„æŸ¥çœ‹å®Œæ•´æ–‡æ¡£

    ## è¯¦ç»†æ–‡æ¡£

    è®¿é—®é¡¹ç›®ä¸»é¡µï¼šhttps://github.com/xiangyugongzuoliu/no-code-architects-toolkit

  variables:
    # ==================== å¿…éœ€é…ç½® ====================
    - key: API_KEY
      type: STRING
      name: ğŸ”‘ API å¯†é’¥
      description: API è®¿é—®å¯†é’¥ï¼ˆå¿…å¡«ï¼‰ï¼Œç”¨äºä¿æŠ¤æ‰€æœ‰ API ç«¯ç‚¹

    # ==================== äº‘å­˜å‚¨é…ç½®ï¼ˆä¸‰é€‰ä¸€ï¼‰====================

    # Cloudflare R2 / S3 å…¼å®¹å­˜å‚¨ï¼ˆæ¨èï¼‰
    - key: S3_ENDPOINT_URL
      type: STRING
      name: ğŸŒ©ï¸ R2/S3 ç«¯ç‚¹ URL
      description: |
        Cloudflare R2 æˆ– S3 å…¼å®¹å­˜å‚¨ç«¯ç‚¹
        R2 ç¤ºä¾‹ï¼šhttps://abc123.r2.cloudflarestorage.com

    - key: S3_ACCESS_KEY
      type: STRING
      name: ğŸ” S3/R2 Access Key
      description: S3/R2 è®¿é—®å¯†é’¥ ID

    - key: S3_SECRET_KEY
      type: STRING
      name: ğŸ”’ S3/R2 Secret Key
      description: S3/R2 å¯†é’¥

    - key: S3_BUCKET_NAME
      type: STRING
      name: ğŸª£ S3/R2 Bucket åç§°
      description: å­˜å‚¨æ¡¶åç§°ï¼ˆå¦‚ï¼šnca-storageï¼‰

    - key: S3_REGION
      type: STRING
      name: ğŸŒ S3/R2 åŒºåŸŸ
      description: |
        R2 å¡«å†™ï¼šauto
        S3 å¡«å†™ï¼šus-east-1 ç­‰

    - key: R2_PUBLIC_DOMAIN
      type: STRING
      name: ğŸ”— R2 è‡ªå®šä¹‰å…¬å¼€åŸŸå
      description: |
        R2 è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰
        ç¤ºä¾‹ï¼šhttps://files.yourdomain.com

    # Google Cloud Storageï¼ˆå¤‡é€‰ï¼‰
    - key: GCP_BUCKET_NAME
      type: STRING
      name: â˜ï¸ GCP å­˜å‚¨æ¡¶åç§°
      description: Google Cloud Storage å­˜å‚¨æ¡¶åç§°ï¼ˆå¯é€‰ï¼‰

    - key: GCP_SA_CREDENTIALS
      type: STRING
      name: ğŸ” GCP æœåŠ¡è´¦å·å‡­è¯
      description: Google Cloud æœåŠ¡è´¦å· JSON å‡­è¯ï¼ˆå®Œæ•´ JSON å­—ç¬¦ä¸²ï¼‰

    # ==================== æ€§èƒ½è°ƒä¼˜ï¼ˆå¯é€‰ï¼‰====================
    - key: GUNICORN_WORKERS
      type: STRING
      name: ğŸ‘· Worker æ•°é‡
      description: Gunicorn worker è¿›ç¨‹æ•°ï¼ˆæ¨èï¼š2-4ï¼‰

    - key: GUNICORN_TIMEOUT
      type: STRING
      name: â±ï¸ Worker è¶…æ—¶æ—¶é—´
      description: Worker è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼Œæ¨èï¼š300-600ï¼‰

    - key: MAX_QUEUE_LENGTH
      type: STRING
      name: ğŸ”„ é˜Ÿåˆ—æœ€å¤§é•¿åº¦
      description: ä»»åŠ¡é˜Ÿåˆ—æœ€å¤§é•¿åº¦ï¼ˆ0=æ— é™åˆ¶ï¼‰

  services:
    - name: nca-toolkit
      icon: https://raw.githubusercontent.com/xiangyugongzuoliu/no-code-architects-toolkit/main/assets/icon.svg
      template: PREBUILT

      spec:
        source:
          image: xiangyugongzuoliu/nca-toolkit:latest

        ports:
          - id: web
            port: 8080
            type: HTTP

        env:
          # å¿…éœ€é…ç½®
          API_KEY:
            default: ${API_KEY}

          # R2/S3 å­˜å‚¨é…ç½®
          S3_ENDPOINT_URL:
            default: ${S3_ENDPOINT_URL}
          S3_ACCESS_KEY:
            default: ${S3_ACCESS_KEY}
          S3_SECRET_KEY:
            default: ${S3_SECRET_KEY}
          S3_BUCKET_NAME:
            default: ${S3_BUCKET_NAME}
          S3_REGION:
            default: ${S3_REGION:-auto}
          R2_PUBLIC_DOMAIN:
            default: ${R2_PUBLIC_DOMAIN}

          # GCP å­˜å‚¨é…ç½®
          GCP_BUCKET_NAME:
            default: ${GCP_BUCKET_NAME}
          GCP_SA_CREDENTIALS:
            default: ${GCP_SA_CREDENTIALS}

          # æ€§èƒ½è°ƒä¼˜
          GUNICORN_WORKERS:
            default: ${GUNICORN_WORKERS:-4}
          GUNICORN_TIMEOUT:
            default: ${GUNICORN_TIMEOUT:-300}
          MAX_QUEUE_LENGTH:
            default: ${MAX_QUEUE_LENGTH:-0}

          # ç³»ç»Ÿé…ç½®ï¼ˆå›ºå®šå€¼ï¼‰
          PORT:
            default: "8080"
          WHISPER_CACHE_DIR:
            default: "/app/whisper_cache"
          LOCAL_STORAGE_PATH:
            default: "/tmp"
          PYTHONUNBUFFERED:
            default: "1"

        # èµ„æºé…ç½®
        resources:
          limits:
            memory: 4Gi
            cpu: "2"
          requests:
            memory: 2Gi
            cpu: "1"
